<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClickTime - Agendamento Facilitado</title>
    <link rel="stylesheet" href="css/style-form.css" />
  </head>
  <body>
    <div class="base">
      <div class="retangulo">
        <div class="logo">
          <img src="Assets/ClickTime.png" width="200px" height="40px" />
        </div>
      </div>
      <div class="form-container">
        <form id="formUsuario">
          <div class="form-group-inline">
            <div class="form-group">
              <label for="nome">Nome:</label>
              <div class="form-input">
                <input
                  type="text"
                  id="nome"
                  placeholder="Digite seu nome"
                  autocomplete="username"
                />
                <span class="icon">
                  <img
                    src="Assets/Images/User.svg"
                    width="25px"
                    class="icon-user"
                  />
                </span>
              </div>
            </div>
            <div class="form-group">
              <label for="sobrenome">Sobrenome:</label>
              <div class="form-input">
                <input
                  type="text"
                  id="sobrenome"
                  placeholder="Digite seu sobrenome"
                  autocomplete="lastname"
                />
                <span class="icon"></span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email:</label>
            <div class="form-input">
              <input
                type="email"
                id="email"
                placeholder="Digite seu email"
                autocomplete="username"
              />
              <span class="icon">
                <img
                  src="Assets/Images/At sign.svg"
                  width="25px"
                  class="icon-sign"
                />
              </span>
            </div>
          </div>

          <div class="form-group">
            <label for="senha">Senha:</label>
            <div class="form-input">
              <input
                type="password"
                id="senha"
                placeholder="Digite sua senha"
                autocomplete="current-password"
              />

              <span class="icon">
                <img
                  src="Assets/Images/cadeado.png"
                  width="25px"
                  class="icon-lock"
                />
              </span>
            </div>
          </div>

          <div class="form-buttons">
            <button type="reset" class="btn-clear">Limpar</button>
            <button type="submit" class="btn-next">Próximo</button>
          </div>
        </form>
      </div>

      <!-- Div para mensagens de erro/sucesso -->
      <div id="msgFeedback" class="msg-feedback" style="display: none"></div>

      <div class="textosrg">
        <h1>
          Comece agora e aproveite uma experiência prática e personalizada!
        </h1>
        <p class="paragrafo">
          Bem-vindo ao ClickTime! Cadastre-se para acessar agendamentos rápidos,
          lembretes automáticos e serviços feitos para você. É simples, é
          prático!
        </p>
        <img
          src="Assets/Images/ILUSTRAÇÃO-CADASTRO.svg"
          width="600px"
          height="480px"
          class="img-cad"
        />
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const backendUrl = "http://localhost:4000/";

        // Carrega o token e o usuário ID do localStorage
        const usuarioId = localStorage.getItem("usuarioId");
        const token = localStorage.getItem("token");

        console.log("usuarioId:", usuarioId); // Verificando se o usuarioId está correto
        console.log("token:", token); // Verificando se o token está correto

        // Verifica se o usuário ID e token estão presentes
        if (!usuarioId || !token) {
          console.error("Usuário ou Token não encontrados!");
          return;
        }

        // Função para salvar a empresa escolhida
        async function salvarEmpresaEscolhida(empresaId) {
          if (!token || !usuarioId) {
            console.error("Token ou usuário não encontrado!");
            return;
          }

          const data = {
            usuarioId: usuarioId,
            empresaId: empresaId,
          };

          try {
            const response = await fetch(`${backendUrl}empresa-escolhida`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              const result = await response.json();
              console.log("Sucesso:", result);
              window.location.href = `servicos${empresaId}.html`;
            } else {
              const errorResponse = await response.text();
              console.error("Erro ao salvar empresa:", errorResponse);
            }
          } catch (error) {
            console.error("Erro ao fazer requisição:", error);
          }
        }

        // Captura o clique em qualquer card de empresa
        const empresaCards = document.querySelectorAll(".empresa-card");
        empresaCards.forEach(function (card) {
          card.addEventListener("click", function () {
            // Recupera o 'data-id' da empresa
            const empresaId = this.getAttribute("data-id");
            console.log("Empresa escolhida: ID =", empresaId); // Exibe o ID da empresa no console

            // Adiciona a classe 'selected' para o card clicado (feedback visual)
            empresaCards.forEach(function (c) {
              c.classList.remove("selected");
            });
            this.classList.add("selected");

            // Armazena o ID da empresa no localStorage
            localStorage.setItem("empresaId", empresaId);

            // Chama a função para salvar a empresa escolhida
            salvarEmpresaEscolhida(empresaId);
          });
        });
      });
    </script>
  </body>
</html>
